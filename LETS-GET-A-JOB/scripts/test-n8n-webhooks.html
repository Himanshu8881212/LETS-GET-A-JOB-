<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Webhook Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .webhook-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .webhook-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .webhook-card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .webhook-card h2::before {
            content: 'üîó';
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input[type="text"],
        input[type="url"],
        input[type="file"],
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="url"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: monospace;
        }

        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .response {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            display: none;
        }

        .response.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            display: block;
        }

        .response.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            display: block;
        }

        .response.loading {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            display: block;
        }

        .response pre {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.05);
            border-radius: 4px;
            overflow-x: auto;
            font-size: 0.85rem;
        }

        .config-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .config-section h2 {
            color: #333;
            margin-bottom: 15px;
        }

        .url-input {
            font-family: monospace;
            font-size: 0.85rem;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.ready {
            background: #28a745;
        }

        .status-indicator.loading {
            background: #ffc107;
            animation: pulse 1s infinite;
        }

        .status-indicator.error {
            background: #dc3545;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .small-text {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ n8n Webhook Tester</h1>

        <!-- Configuration Section -->
        <div class="config-section">
            <h2>‚öôÔ∏è Webhook Configuration</h2>
            <div class="form-group">
                <label>Job Description Webhook URL</label>
                <input type="url" id="jdWebhookUrl" class="url-input" placeholder="https://your-ngrok-url/webhook/process-jd">
            </div>
            <div class="form-group">
                <label>Resume Webhook URL</label>
                <input type="url" id="resumeWebhookUrl" class="url-input" placeholder="https://your-ngrok-url/webhook/process-resume">
            </div>
            <div class="form-group">
                <label>Cover Letter Webhook URL</label>
                <input type="url" id="coverLetterWebhookUrl" class="url-input" placeholder="https://your-ngrok-url/webhook/process-cover-letter">
            </div>
            <div class="form-group">
                <label>ATS Evaluation Webhook URL</label>
                <input type="url" id="evaluationWebhookUrl" class="url-input" placeholder="https://your-ngrok-url/webhook/evaluate-ats">
            </div>
            <button onclick="loadFromEnv()">üìã Load from .env.local</button>
            <p class="small-text">Or manually paste your webhook URLs above</p>
        </div>

        <!-- Webhook Test Cards -->
        <div class="webhook-grid">
            <!-- Test 1: Job Description -->
            <div class="webhook-card">
                <h2><span class="status-indicator ready" id="status1"></span>Job Description</h2>
                <div class="form-group">
                    <label>Job URL</label>
                    <input type="url" id="jobUrl" value="https://www.linkedin.com/jobs/view/3901234567" placeholder="Enter job posting URL">
                </div>
                <button onclick="testJobDescription()">üîç Test Job Description</button>
                <div class="response" id="response1"></div>
            </div>

            <!-- Test 2: Resume -->
            <div class="webhook-card">
                <h2><span class="status-indicator ready" id="status2"></span>Resume Processing</h2>
                <div class="form-group">
                    <label>Upload Resume PDF</label>
                    <input type="file" id="resumeFile" accept=".pdf">
                </div>
                <button onclick="testResume()">üìÑ Test Resume</button>
                <div class="response" id="response2"></div>
            </div>

            <!-- Test 3: Cover Letter -->
            <div class="webhook-card">
                <h2><span class="status-indicator ready" id="status3"></span>Cover Letter Processing</h2>
                <div class="form-group">
                    <label>Upload Cover Letter PDF</label>
                    <input type="file" id="coverLetterFile" accept=".pdf">
                </div>
                <button onclick="testCoverLetter()">‚úâÔ∏è Test Cover Letter</button>
                <div class="response" id="response3"></div>
            </div>

            <!-- Test 4: ATS Evaluation -->
            <div class="webhook-card">
                <h2><span class="status-indicator ready" id="status4"></span>ATS Evaluation</h2>
                <div class="form-group">
                    <label>Resume Text</label>
                    <textarea id="resumeText" placeholder="Paste resume text here...">John Doe
Software Engineer
5 years experience in React, Node.js, Python, TypeScript
Built scalable web applications serving 1M+ users</textarea>
                </div>
                <div class="form-group">
                    <label>Cover Letter Text</label>
                    <textarea id="coverLetterText" placeholder="Paste cover letter text here...">Dear Hiring Manager,
I am excited to apply for the Software Engineer position.</textarea>
                </div>
                <div class="form-group">
                    <label>Job Description Text</label>
                    <textarea id="jobDescText" placeholder="Paste job description text here...">We are looking for a Software Engineer with experience in React and Node.js to build modern web applications.</textarea>
                </div>
                <button onclick="testEvaluation()">‚ö° Test Evaluation</button>
                <div class="response" id="response4"></div>
            </div>
        </div>
    </div>

    <script>
        // Load webhook URLs from .env.local (you'll need to paste them manually)
        function loadFromEnv() {
            const envText = prompt('Paste the contents of your .env.local file here:');
            if (!envText) return;

            const lines = envText.split('\n');
            lines.forEach(line => {
                if (line.includes('NEXT_PUBLIC_N8N_JD_WEBHOOK_URL=')) {
                    document.getElementById('jdWebhookUrl').value = line.split('=')[1].trim();
                }
                if (line.includes('NEXT_PUBLIC_N8N_RESUME_WEBHOOK_URL=')) {
                    document.getElementById('resumeWebhookUrl').value = line.split('=')[1].trim();
                }
                if (line.includes('NEXT_PUBLIC_N8N_COVER_LETTER_WEBHOOK_URL=')) {
                    document.getElementById('coverLetterWebhookUrl').value = line.split('=')[1].trim();
                }
                if (line.includes('NEXT_PUBLIC_N8N_EVALUATION_WEBHOOK_URL=')) {
                    document.getElementById('evaluationWebhookUrl').value = line.split('=')[1].trim();
                }
            });
            alert('‚úÖ Webhook URLs loaded!');
        }

        function showResponse(id, type, message, data = null) {
            const responseDiv = document.getElementById(`response${id}`);
            const statusIndicator = document.getElementById(`status${id}`);
            
            responseDiv.className = `response ${type}`;
            responseDiv.innerHTML = message;
            
            if (data) {
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(data, null, 2);
                responseDiv.appendChild(pre);
            }

            statusIndicator.className = `status-indicator ${type === 'success' ? 'ready' : type}`;
        }

        async function testJobDescription() {
            const url = document.getElementById('jdWebhookUrl').value;
            const jobUrl = document.getElementById('jobUrl').value;

            if (!url) {
                showResponse(1, 'error', '‚ùå Please configure the Job Description webhook URL');
                return;
            }

            showResponse(1, 'loading', '‚è≥ Processing job description...');
            document.getElementById('status1').className = 'status-indicator loading';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ jobUrl })
                });

                const data = await response.json();

                if (response.ok) {
                    showResponse(1, 'success', '‚úÖ Success! Job description processed', data);
                } else {
                    showResponse(1, 'error', `‚ùå Error: ${response.status} ${response.statusText}`, data);
                }
            } catch (error) {
                showResponse(1, 'error', `‚ùå Error: ${error.message}`);
            }
        }

        async function testResume() {
            const url = document.getElementById('resumeWebhookUrl').value;
            const fileInput = document.getElementById('resumeFile');
            const file = fileInput.files[0];

            if (!url) {
                showResponse(2, 'error', '‚ùå Please configure the Resume webhook URL');
                return;
            }

            if (!file) {
                showResponse(2, 'error', '‚ùå Please select a PDF file');
                return;
            }

            showResponse(2, 'loading', '‚è≥ Processing resume PDF...');
            document.getElementById('status2').className = 'status-indicator loading';

            try {
                const formData = new FormData();
                formData.append('data', file);

                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    showResponse(2, 'success', '‚úÖ Success! Resume processed', data);
                } else {
                    showResponse(2, 'error', `‚ùå Error: ${response.status} ${response.statusText}`, data);
                }
            } catch (error) {
                showResponse(2, 'error', `‚ùå Error: ${error.message}`);
            }
        }

        async function testCoverLetter() {
            const url = document.getElementById('coverLetterWebhookUrl').value;
            const fileInput = document.getElementById('coverLetterFile');
            const file = fileInput.files[0];

            if (!url) {
                showResponse(3, 'error', '‚ùå Please configure the Cover Letter webhook URL');
                return;
            }

            if (!file) {
                showResponse(3, 'error', '‚ùå Please select a PDF file');
                return;
            }

            showResponse(3, 'loading', '‚è≥ Processing cover letter PDF...');
            document.getElementById('status3').className = 'status-indicator loading';

            try {
                const formData = new FormData();
                formData.append('data', file);

                const response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    showResponse(3, 'success', '‚úÖ Success! Cover letter processed', data);
                } else {
                    showResponse(3, 'error', `‚ùå Error: ${response.status} ${response.statusText}`, data);
                }
            } catch (error) {
                showResponse(3, 'error', `‚ùå Error: ${error.message}`);
            }
        }

        async function testEvaluation() {
            const url = document.getElementById('evaluationWebhookUrl').value;
            const resumeText = document.getElementById('resumeText').value;
            const coverLetterText = document.getElementById('coverLetterText').value;
            const jobDescText = document.getElementById('jobDescText').value;

            if (!url) {
                showResponse(4, 'error', '‚ùå Please configure the Evaluation webhook URL');
                return;
            }

            showResponse(4, 'loading', '‚è≥ Running ATS evaluation...');
            document.getElementById('status4').className = 'status-indicator loading';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        resume_text: resumeText,
                        cover_letter_text: coverLetterText,
                        job_description: jobDescText
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    showResponse(4, 'success', '‚úÖ Success! ATS evaluation complete', data);
                } else {
                    showResponse(4, 'error', `‚ùå Error: ${response.status} ${response.statusText}`, data);
                }
            } catch (error) {
                showResponse(4, 'error', `‚ùå Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>

